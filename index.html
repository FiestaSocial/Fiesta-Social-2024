<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fiesta Social 2024</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{--c1:#0b66ff;--c1d:#084dcc;--c2:#f59e0b;--mut:#6b7280;--b:#e5e7eb;--ok:#22c55e;--err:#ef4444;--sh:0 24px 60px rgba(15,23,42,.25);--r:28px;--r2:18px;--r3:12px}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;font-family:Poppins,'Segoe UI',sans-serif;
      background:radial-gradient(circle at top left,rgba(59,130,246,.45),transparent 55%),
                 radial-gradient(circle at bottom right,rgba(234,179,8,.35),transparent 55%),
                 linear-gradient(135deg,#0f172a,#1e293b 45%,#0f172a 90%);
      color:#0f172a;padding:40px 16px 60px;display:flex;justify-content:center}
    main{width:100%;max-width:1080px}
    h1,h2,h3{margin:0 0 12px} p{margin:0 0 16px;color:var(--mut)}
    .container{background:#fff;border-radius:var(--r);padding:32px 32px 40px;box-shadow:var(--sh);display:none;margin-bottom:32px;position:relative;overflow:hidden}
    .container.active{display:block;animation:fade .45s ease}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .hero-card{display:grid;gap:32px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));align-items:center}
    .hero-card__eyebrow{display:inline-flex;gap:8px;padding:6px 14px;border-radius:999px;background:rgba(11,102,255,.1);color:var(--c1);font-weight:600;text-transform:uppercase;letter-spacing:.08em;font-size:12px}
    .hero-card__title{font-size:clamp(32px,5vw,48px);font-weight:700;margin-bottom:16px}
    .hero-card__media img{width:100%;display:block;border-radius:16px;box-shadow:0 14px 35px rgba(15,23,42,.18)}
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px}
    .form-field{display:flex;flex-direction:column;gap:8px}
    label{font-weight:600}
    input,select,textarea{padding:12px 14px;border-radius:var(--r3);border:1px solid var(--b);background:#f8fafc;font-size:15px}
    textarea{min-height:84px;resize:vertical}
    input:focus,select:focus,textarea:focus{outline:none;border-color:rgba(11,102,255,.8);box-shadow:0 0 0 4px rgba(11,102,255,.12)}
    .button{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:none;border-radius:999px;padding:12px 24px;font-weight:600;cursor:pointer}
    .button--primary{background:var(--c1);color:#fff}
    .button--ghost{background:rgba(15,23,42,.05);color:var(--c1)}
    .navigation-buttons{margin-top:32px;display:flex;gap:16px;justify-content:flex-end}
    .salon-wrapper{display:grid;grid-template-columns:260px 1fr;gap:28px;margin-bottom:32px;align-items:start}
    .salon-summary{background:rgba(248,250,252,.9);border-radius:var(--r2);padding:20px;box-shadow:0 8px 24px rgba(15,23,42,.08);position:sticky;top:32px}
    .legend{display:flex;flex-direction:column;gap:8px}
    .legend-swatch{width:16px;height:16px;border-radius:4px;display:inline-block;margin-right:8px}
    .legend .available{background:var(--c1)} .legend .full{background:var(--err)} .legend .selected{background:var(--c2)}
    .salon-map{position:relative;width:100%;aspect-ratio:16/9;background:linear-gradient(135deg,rgba(226,232,240,.8),rgba(203,213,225,.6));border-radius:var(--r2);box-shadow:0 20px 40px rgba(15,23,42,.18);overflow:hidden}
    .map-zone{position:absolute;left:calc(var(--zone-x,50)*1%);top:calc(var(--zone-y,50)*1%);transform:translate(-50%,-50%);padding:6px 16px;border-radius:999px;background:rgba(15,23,42,.7);color:#fff;font-weight:600;font-size:12px;z-index:1}
    .map-zone--dance{background:rgba(34,197,94,.85)} .map-zone--stage,.map-zone--entrance,.map-zone--dj,.map-zone--dessert{background:rgba(59,130,246,.9)}
    .mesa{position:absolute;width:52px;height:52px;border-radius:16px;background:var(--c1);color:#fff;font-weight:700;display:flex;align-items:center;justify-content:center;transform:translate(-50%,-50%);border:none;cursor:pointer}
    .mesa.completa{background:var(--err)} .mesa.seleccionada{background:var(--c2)}
    .table-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;margin-bottom:24px}
    .table-container{position:relative;width:100%;padding-top:100%;border-radius:var(--r2);background:rgba(248,250,252,.9);box-shadow:inset 0 0 0 1px rgba(15,23,42,.08);display:none}
    #seatsContainer{position:absolute;inset:0}
    .table{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:120px;height:120px;border-radius:50%;background:var(--c1);color:#fff;display:flex;align-items:center;justify-content:center}
    .seat{width:42px;height:42px;border-radius:12px;background:var(--ok);position:absolute;transform:translate(-50%,-50%)} .seat.occupied{background:var(--err)}
    #guestList{min-height:160px;background:rgba(248,250,252,.85);border-radius:var(--r2);padding:16px;box-shadow:inset 0 0 0 1px rgba(15,23,42,.08)}
    .modal-overlay{position:fixed;inset:0;background:rgba(15,23,42,.65);display:none;align-items:center;justify-content:center;padding:24px;z-index:100}
    .modal-overlay.active{display:flex}
    .modal-content{background:#fff;border-radius:24px;padding:28px;max-width:520px;box-shadow:var(--sh);text-align:left}
    .modal-actions{display:flex;justify-content:flex-end;gap:12px;margin-top:16px}
  </style>
</head>
<body>
<main>
  <!-- Pantalla 1 -->
  <section id="screen1" class="container active">
    <div class="hero-card" id="heroCard"></div>
  </section>

  <!-- Pantalla 2 -->
  <section id="screen2" class="container">
    <h2>Datos personales</h2>
    <p>Completa tus datos para asegurar tu lugar.</p>
    <form id="guestForm" class="form-grid" autocomplete="on">
      <div class="form-field"><label for="correo">Correo</label><input id="correo" name="correo" type="email" required></div>
      <div class="form-field"><label for="grado">Grado</label>
        <select id="grado" name="grado" required>
          <option value="" selected>Seleccionar</option><option>Cnel.</option><option>Tte. Cnel.</option><option>May.</option><option>Cap.</option><option>Tte. 1°</option><option>Tte. 2°</option><option>Alf.</option>
        </select>
      </div>
      <div class="form-field"><label for="escalafon">Escalafón</label>
        <select id="escalafon" name="escalafon" required>
          <option value="" selected>Seleccionar</option><option>(Av.)</option><option>(Nav.)</option><option>(Esp.)</option><option>(T.P.)</option>
        </select>
      </div>
      <div class="form-field"><label for="nombre">Nombre</label><input id="nombre" name="nombre" required></div>
      <div class="form-field"><label for="apellido">Apellido</label><input id="apellido" name="apellido" required></div>

      <!-- CI más tolerante: con o sin puntos -->
      <div class="form-field"><label for="cedula">Cédula (0.000.000-0)</label>
        <input id="cedula" name="cedula" required pattern="^\d(\.?\d{3}){2}-\d$">
      </div>

      <div class="form-field"><label for="menu">Menú</label>
        <select id="menu" name="menu" required>
          <option value="" selected>Seleccionar</option>
          <option value="normal">Normal</option><option value="vegetariano">Vegetariano</option>
          <option value="vegano">Vegano</option><option value="celiaco">Celíaco</option>
        </select>
      </div>

      <div class="form-field" style="grid-column:1/-1">
        <label for="observacion">Observaciones</label>
        <textarea id="observacion" name="observacion" placeholder="Alergias, preferencias, etc."></textarea>
      </div>

      <div class="form-field"><label for="acompanante">¿Asiste con acompañante?</label>
        <select id="acompanante" name="acompanante" required><option value="" selected>Seleccionar</option><option value="no">No</option><option value="si">Sí</option></select>
      </div>
      <div class="form-field" id="acompananteCantidad" style="display:none;">
        <label for="cantidadAcompanantes">¿Cuántos acompañantes? (máx. 4)</label>
        <select id="cantidadAcompanantes" name="cantidadAcompanantes">
          <option value="" selected>Seleccionar</option><option>1</option><option>2</option><option>3</option><option>4</option>
        </select>
      </div>
      <input type="hidden" id="mesa" name="mesa">
    </form>
    <div class="navigation-buttons">
      <button class="button button--ghost" data-prev="1">Anterior</button>
      <button class="button button--primary" data-next>Continuar</button>
    </div>
  </section>

  <!-- Pantalla 3 -->
  <section id="screen3" class="container">
    <h2>Información de acompañantes</h2>
    <form id="acompanantesForm"></form>
    <div class="navigation-buttons">
      <button class="button button--ghost" data-prev="2">Anterior</button>
      <button class="button button--primary" data-next="4">Continuar</button>
    </div>
  </section>

  <!-- Pantalla 4, resumen/salón... (igual que la versión anterior que te funcionó) -->
  <!-- OMITIDO POR BREVEDAD: usa el mismo bloque de salón/previo/tooltip/submit de mi respuesta anterior,
       ya estaba correcto. No cambié nada de esa parte, solo la validación y los campos de CI. -->

</main>

<!-- Modales existentes: registro completo / duplicado (usa los que ya tienes) -->

<script>
/* ===== Solo te muestro las 3 funciones donde hice los cambios de validación ===== */

// 1) Mostrar/ocultar bloque de acompañantes y manejar "required"
function toggleAcompanante(){
  const a=document.getElementById('acompanante').value;
  const box=document.getElementById('acompananteCantidad');
  const sel=document.getElementById('cantidadAcompanantes');
  if(a==='si'){ box.style.display='block'; sel.required=true; }
  else{ box.style.display='none'; sel.required=false; sel.value=''; document.getElementById('acompanantesForm').innerHTML=''; }
}

// 2) Generar acompañantes (CI con patrón tolerante + observaciones)
function renderAcompanantes(n){
  const cont=document.getElementById('acompanantesForm');
  cont.innerHTML='';
  for(let i=1;i<=n;i++){
    cont.insertAdjacentHTML('beforeend',`
      <div class="form-grid">
        <div class="form-field">
          <h3>Acompañante ${i}</h3>
          <label for="nombreAcompanante${i}">Nombre</label>
          <input id="nombreAcompanante${i}" name="nombreAcompanante${i}" required>
        </div>
        <div class="form-field">
          <label for="cedulaAcompanante${i}">Cédula (0.000.000-0)</label>
          <input id="cedulaAcompanante${i}" name="cedulaAcompanante${i}" required pattern="^\\d(\\.?\\d{3}){2}-\\d$">
        </div>
        <div class="form-field">
          <label for="menuAcompanante${i}">Menú</label>
          <select id="menuAcompanante${i}" name="menuAcompanante${i}" required>
            <option value="" selected>Seleccionar</option>
            <option value="normal">Normal</option><option value="vegetariano">Vegetariano</option>
            <option value="vegano">Vegano</option><option value="celiaco">Celíaco</option>
          </select>
        </div>
        <div class="form-field" style="grid-column:1/-1">
          <label for="obsAcompanante${i}">Observaciones</label>
          <textarea id="obsAcompanante${i}" name="obsAcompanante${i}" placeholder="Alergias, preferencias, etc."></textarea>
        </div>
      </div>`);
  }
}

// 3) Validador que ignora elementos ocultos (evita falsos “Completa…”)
function validateForm(id){
  const form=document.getElementById(id); if(!form) return [];
  const bad=[];
  form.querySelectorAll('input,select,textarea').forEach(el=>{
    // si el elemento no es visible, no se valida
    const hidden = (el.offsetParent === null);
    if(!hidden && !el.checkValidity()){
      const lab=form.querySelector(`label[for="${el.id}"]`);
      bad.push((lab?lab.textContent:el.name||el.id).replace(':','').trim());
    }
  });
  return bad;
}
</script>
</body>
</html>
