<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Fiesta Social 2024 — Registro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 24px; }
    h1 { margin-top: 0; }
    form { max-width: 680px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { font-weight: 600; }
    input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
    .full { grid-column: 1 / -1; }
    button { padding: 10px 16px; cursor: pointer; }
    .note { color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>Confirmación de asistencia</h1>

  <form id="rsvp-form" autocomplete="on">
    <div>
      <label>Nombre</label>
      <input name="nombre" required>
    </div>
    <div>
      <label>Apellido</label>
      <input name="apellido" required>
    </div>

    <div>
      <label>Cédula</label>
      <input name="cedula">
    </div>
    <div>
      <label>Correo</label>
      <input type="email" name="correo" required>
    </div>

    <div>
      <label>Mesa</label>
      <input name="mesa" placeholder="Ej.: M1">
    </div>
    <div>
      <label>Grado</label>
      <input name="grado">
    </div>

    <div>
      <label>Escalafón</label>
      <input name="escalafon">
    </div>
    <div>
      <label>Menú titular</label>
      <input name="menu" placeholder="Clásico / Vegetariano / Infantil">
    </div>

    <div class="full">
      <label>Acompañantes (separados por “;”)</label>
      <input name="acompanantes" placeholder="Juan; María">
    </div>

    <div class="full">
      <button type="submit">Confirmar asistencia</button>
      <span class="note">Se registrará la fecha del cliente y del servidor.</span>
    </div>
  </form>

  <script>
  // URL del Web App (termina en /exec)
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbz0hK6FlSgcb1UWmUEUKiESY5awhMYUTGbD70pBazuRNxPEWwudrWQcM-u6Flo69ynMNw/exec';

  function buildParamsFromForm(form) {
    const fd = new FormData(form);
    const params = new URLSearchParams(fd);

    // Fecha del cliente
    params.set('submittedAt', new Date().toISOString());

    // Si además usas inputs individuales como acompanante1/2/3, podrías recolectarlos:
    const extra = Array.from(form.querySelectorAll('[name^="acompanante"]'))
      .map(i => (i.value || '').trim()).filter(Boolean);
    if (extra.length) {
      const base = (params.get('acompanantes') || '').trim();
      const merged = [base, ...extra].filter(Boolean).join(';');
      params.set('acompanantes', merged);
    }
    return params;
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('rsvp-form');
    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const params = buildParamsFromForm(form);
      try {
        // Importante: sin headers → evita preflight CORS
        const res  = await fetch(ENDPOINT, { method: 'POST', body: params });
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || 'Error desconocido');
        alert('¡Gracias! Registramos tu respuesta.');
        form.reset();
      } catch (e) {
        console.error(e);
        alert('No pudimos registrar tu respuesta. Intenta nuevamente.');
      }
    });
  });
  </script>
</body>
</html>
